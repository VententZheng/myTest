<!-- 导入个人中心左侧导航 -->
<include file="User/index" />

<!-- 修改头像CSS -->
<link href="__PUBLIC__/Home/Uploadpic/head/cropper.min.css" rel="stylesheet">
<link href="__PUBLIC__/Home/Uploadpic/head/sitelogo.css" rel="stylesheet">
<link href="__PUBLIC__/Home/Uploadpic/head/sitelogo.css" rel="stylesheet">

<!--   个人资料  -->
<div class="mydata col-lg-10 col-md-10 col-sm-9 col-xs-12">
    <div class="mydata-title">
        <h3>个人资料</h3>
    </div>
    <ul id="myTab" class="nav nav-tabs">
        <li class="active"><a href="#headPic" data-toggle="tab"><i class="glyphicon glyphicon-picture"></i>&nbsp;头像设置</a></li>
        <li><a href="#myInformation" data-toggle="tab"><i class="glyphicon glyphicon-user"></i>个人信息</a></li>
    </ul>

    <div id="myTabContent" class="tab-content  col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <!-- 用户头像修改 -->
        <div class="tab-pane fade in active" id="headPic">
            <ul class="myavatar">
                <li class="avatarimg"><img id="userimg" src="__PUBLIC__/Home/image/user_img/{$mydata.head_pic}" style="border:black 1px solid;"></li>
                <li class=""><a href="javascript:void(0)" data-toggle="modal" data-target="#avatar-modal">修改头像</a></li>
            </ul>
        </div>

        <!-- 修改头像模态框 -->
                    <div class="modal fade head-modal" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content col-lg-offset-0 col-lg-12 col-md-offset-0 col-md-12 col-sm-offset-0 col-sm-12 col-xs-offset-0 col-xs-12">
                                <form class="avatar-form" action="__CONTROLLER__/test" enctype="multipart/form-data" method="post">
                                   
                                    <div class="modal-header">
                                        <button class="close" data-dismiss="modal" type="button">&times;</button>
                                        <h4 class="modal-title" id="avatar-modal-label">头像修改</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="avatar-body">
                                            <div class="avatar-upload">
                                                <input class="avatar-src" name="avatar_src" type="hidden">
                                                <input class="avatar-data" name="avatar_data" type="hidden">
                                                <button class="btn select-pic" type="button" onClick="$('input[id=avatarInput]').click();">请选择本地照片</button>
                                                <span id="avatar-name" title="上传图片名称"></span>
                                                <input class="avatar-input hide" id="avatarInput" name="avatar_file" type="file">
                                            </div>
                                            <!--  图片画布 -->
                                            <div class="row">
                                                <div class="col-md-8 col-md-8 col-sm-8 col-xs-12">
                                                    <div class="avatar-wrapper"></div>
                                                </div>
                                                <div class="head-preview col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                    <h4>头像预览</h4>
                                                    <div class="avatar-preview preview-lg" id="imageHead"></div>
                                                </div>
                                            </div>

                                            <div class="row avatar-btns">
                                                <div class="col-md-9 col-md-9 col-sm-9 col-xs-12">
                                                    <div class="btn-group">
                                                        <button class="btn fa fa-undo" data-method="rotate" data-option="-90" type="button" title="向左旋转"></button>
                                                    </div>
                                                    <div class="btn-group">
                                                        <button class="btn fa fa-repeat" data-method="rotate" data-option="90" type="button" title="向右旋转"></button>
                                                    </div>
                                                    <button class="btn fa fa-arrows" data-method="setDragMode" data-option="move" type="button" title="移动">
                                                        <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;setDragMode&quot;, &quot;move&quot;)">
                                </span>
                                                    </button>
                                                    <button type="button" class="btn fa fa-search-plus" data-method="zoom" data-option="0.1" title="放大图片">
                                                        <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, 0.1)">
                                                        </span>
                                                    </button>
                                                    <button type="button" class="btn fa fa-search-minus" data-method="zoom" data-option="-0.1" title="缩小图片">
                                                        <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, -0.1)">
                                                        </span>
                                                    </button>
                                                    <button type="button" class="btn fa fa-refresh" data-method="reset" title="重置图片">
                                                        <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;reset&quot;)" aria-describedby="tooltip866214"></span>
                                                    </button>
                                                </div>
                                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                                                    <button class="btn btn-block avatar-save fa fa-save" type="button" data-dismiss="modal"> 保存修改</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- 修改头像模态框结束 -->


        <!-- 个人信息修改 -->
        <div class="tab-pane fade" id="myInformation">
            <!-- 显示个人信息-->
            <div class="myinfor-show col-lg-12 col-md-12 col-sm-12 col-xs-12" id="myinfor-show">
                <form class="form-horizontal" role="form">
                    <div class="form-group">
                        <label for="nickname" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">昵&nbsp;&nbsp;&nbsp;称</label>
                        <div class="col-lg-6 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" id="" value="{$mydata.username}" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="realname" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">真实姓名</label>
                        <div class="col-lg-6 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" id="" value="{$mydata.realname}" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sex" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">性&nbsp;&nbsp;&nbsp;别</label>
                        <div class="col-lg-6 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" id="" value="{$mydata.sex}" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="occupation" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">职&nbsp;&nbsp;&nbsp;业</label>
                        <div class="col-lg-6 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" id="" value="{$mydata.occupation}" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">所在地</label>
                        <div class="col-lg-6 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" id="" value="{$mydata.province} {$mydata.city} {$mydata.district}" readonly>
                        </div>
                    </div>
                    <div class="form-group mymotto">
                        <label for="name" class="control-label col-lg-2 col-md-2 col-sm-3 col-xs-3">个性签名</label>
                        <div class="col-lg-6 col-md-9 col-sm-9 col-xs-9">
                            <p class="form-control">{$mydata.motto}</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-offset-2 col-lg-10 col-md-offset-2 col-md-10 col-sm-offset-3 col-sm-9 col-xs-offset-3 col-sm-9">
                            <button type="button" id="mydata-edit-btn" class="btn btn-default col-lg-4 col-md-6 col-sm-8 col-xs-8">修&nbsp;改</button>
                        </div>
                    </div>
                </form>
            </div>
            <!-- 点击修改出现修改表单 -->
            <div class="myinfor-edit col-lg-12 col-md-12 col-sm-12 col-xs-12" id="myinfor-edit" style="display:none">
                <form class="form-horizontal" action="{:U('User/updateData')}" method="post" role="form">
                    <div class="form-group">
                        <label for="nickname" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">昵&nbsp;&nbsp;&nbsp;称：</label>
                        <div class="col-lg-7 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" name="username" value="{$mydata.username}" placeholder="请输入昵称" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="realname" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">真实姓名：</label>
                        <div class="col-lg-7 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" name="realname" placeholder="请输入真实姓名" value="{$mydata.realname}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sex" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">性&nbsp;&nbsp;&nbsp;别：</label>
                        <div class="col-lg-7 col-md-9 col-sm-9 col-xs-9">
                            <div class="radio" requird>
                                <label style="margin-right:30px;">
                                    <input type="radio" name="sex" id="optionsRadios1" value="男"> 男
                                </label>
                                <label>
                                    <input type="radio" name="sex" id="optionsRadios2" value="女">女
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="occupation" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">职&nbsp;&nbsp;&nbsp;业：</label>
                        <div class="col-lg-7 col-md-9 col-sm-9 col-xs-9">
                            <input type="text" class="form-control" name="occupation" placeholder="请输入职业" value="{$mydata.occupation}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address" class="col-lg-2 col-md-2 col-sm-3 col-xs-3 control-label">所在地：</label>
                        <div class="address-edit col-lg-7 col-md-9 col-sm-9 col-xs-9" id="distpicker">
                            <select data-province="{$mydata.province}" class="col-lg-3 col-md-3 col-sm-4 col-xs-12" name="province"></select>
                            <select data-city="{$mydata.city}" class="col-lg-3 col-md-3 col-sm-4 col-xs-12" name="city"></select>
                            <select data-district="{$mydata.district}" class="col-lg-3 col-md-3 col-sm-4 col-xs-12" name="district"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="name" class="control-label col-lg-2 col-md-2 col-sm-3 col-xs-3">个性签名</label>
                        <div class="col-lg-7 col-md-9 col-sm-9 col-xs-9">
                            <textarea class="form-control" id="mymotto-edit" rows="3" name="motto" placeholder="请输入您的个性签名"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-offset-2 col-lg-10 col-md-offset-2 col-md-10 col-sm-offset-3 col-sm-10 col-xs-offset-3 col-xs-10">
                            <button type="submit" class="btn btn-default mydata-save col-lg-4 col-md-4 col-sm-6 col-xs-8" id="mydata-save">保&nbsp;存</button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>


<!-- JavaScript   -->
<script src="__PUBLIC__/Home/Distpicker-js/distpicker.data.js"></script>
<script src="__PUBLIC__/Home/Distpicker-js/distpicker.js"></script>
<script src="__PUBLIC__/Home/Distpicker-js/main.js"></script>
<script>
    $("#distpicker").distpicker({
        autoSelect: false
    });
</script>

<!--  修改个人信息  -->
<script>
    $(document).ready(function () {
        var motto = "<?php echo($mydata['motto']); ?>";
        $("#mydata-edit-btn").click(function () {
            $("#myinfor-show").hide();
            $("#myinfor-edit").show();
            $('#mymotto-edit').html(motto);
        });
        $("#mydata-save").click(function () {
            $("#myinfor-show").show();
            $("#myinfor-edit").hide();
        });
    });
</script>

<div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>
    <script type="text/javascript" src="__PUBLIC__/Home/Uploadpic/head/jquery.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Home/Uploadpic/head/bootstrap.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Home/Uploadpic/head/cropper.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Home/Uploadpic/head/sitelogo.js"></script>
    <script src="__PUBLIC__/Home/Uploadpic/head/html2canvas.min.js" type="text/javascript" charset="utf-8"></script>
    <!-- 修改头像 -->
    <script type="text/javascript">
        //做个下简易的验证  大小 格式 
        $('#avatarInput').on('change', function (e) {
            var filemaxsize = 1024 * 5; //5M
            var target = $(e.target);
            var Size = target[0].files[0].size / 1024;
            if (Size > filemaxsize) {
                alert('图片过大，请重新选择!');
                $(".avatar-wrapper").childre().remove;
                return false;
            }
            if (!this.files[0].type.match(/image.*/)) {
                alert('请选择正确的图片!')
            } else {
                var filename = document.querySelector("#avatar-name");
                var texts = document.querySelector("#avatarInput").value;
                var teststr = texts; //你这里的路径写错了
                testend = teststr.match(/[^\\]+\.[^\(]+/i); //直接完整文件名的
                filename.innerHTML = testend;
            }

        });

        $(".avatar-save").on("click", function () {
            var img_lg = document.getElementById('imageHead');
            // 截图小的显示框内的内容
            html2canvas(img_lg, {
                allowTaint: true,
                taintTest: false,
                onrendered: function (canvas) {
                    canvas.id = "mycanvas";
                    //生成base64图片数据
                    var dataUrl = canvas.toDataURL("image/jpg"); //生成的base68
                    var newImg = document.createElement("img");
                    newImg.src = dataUrl;
                    //                alert(newImg.src);
                    imagesAjax(dataUrl);
                }
            });
        });

        function imagesAjax(src) {
            var pic = src;
            $.ajax({
                url: "__CONTROLLER__/editUserimg",
                data: {
                    basecode: pic
                },
                type: "POST",
                dataType: 'html',
                success: function (data) {
                    var pic_route = '__PUBLIC__/Home/image/user_img/'+data;
                    $('#userimg').attr('src', pic_route);
                    window.location.href="{:U('User/myData')}"
                }
            });
        }
    </script>

<!-- 侧边导航点击变颜色 -->
    <script type="text/javascript">
        $("#mydata").addClass('centerhome');
    </script>

 <!-- -------------footer底部--------- -->
<include file="Public/footer" />